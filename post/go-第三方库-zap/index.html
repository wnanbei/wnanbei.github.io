<!doctype html><html lang=zh-cn>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="此包用于结构化记录日志。
安装：
go get -u go.uber.org/zap 导入：
import &amp;#34;go.uber.org/zap&amp;#34; 优点：
 性能高，与 Zerolog 同一水平。 "><title>Go 第三方库 zap</title>
<link rel=canonical href=https://wnanbei.github.io/post/go-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-zap/>
<link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Go 第三方库 zap">
<meta property="og:description" content="此包用于结构化记录日志。
安装：
go get -u go.uber.org/zap 导入：
import &amp;#34;go.uber.org/zap&amp;#34; 优点：
 性能高，与 Zerolog 同一水平。 ">
<meta property="og:url" content="https://wnanbei.github.io/post/go-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-zap/">
<meta property="og:site_name" content="WNANBEI">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Go"><meta property="article:published_time" content="2021-08-05T00:00:00+00:00"><meta property="article:modified_time" content="2021-11-09T23:34:24+08:00">
<meta name=twitter:title content="Go 第三方库 zap">
<meta name=twitter:description content="此包用于结构化记录日志。
安装：
go get -u go.uber.org/zap 导入：
import &amp;#34;go.uber.org/zap&amp;#34; 优点：
 性能高，与 Zerolog 同一水平。 ">
<link rel="shortcut icon" href=images/favicon.jpg>
</head>
<body class="article-page has-toc">
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex
extended">
<div id=article-toolbar>
<a href=/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>返回</span>
</a>
</div>
<main class="main full-width">
<article class=main-article>
<header class=article-header>
<div class=article-details>
<header class=article-category>
<a href=/categories/go%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/>
Go第三方库
</a>
</header>
<h2 class=article-title>
<a href=/post/go-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-zap/>Go 第三方库 zap</a>
</h2>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2021-08-05</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
阅读时长: 5 分钟
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<p>此包用于结构化记录日志。</p>
<p>安装：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>go get -u go.uber.org/zap
</code></pre></div><p>导入：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;go.uber.org/zap&#34;</span>
</code></pre></div><p>优点：</p>
<ul>
<li>性能高，与 Zerolog 同一水平。</li>
</ul>
<h2 id=创建-logger>创建 Logger</h2>
<h3 id=new>New</h3>
<p>创建 <code>Logger</code> 最基础的方式是使用 <code>New</code> 方法：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>core</span> <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>Core</span>, <span style=color:#a6e22e>options</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>Option</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>
</code></pre></div><p>此方法需要传入 <code>zapcore</code> 和 <code>option</code> 来进行构造。通常需要深度定制时使用此方法。</p>
<p>例子：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>EncoderConfig</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>EncoderConfig</span>{
    <span style=color:#a6e22e>MessageKey</span>:     <span style=color:#e6db74>&#34;msg&#34;</span>,
    <span style=color:#a6e22e>LevelKey</span>:       <span style=color:#e6db74>&#34;level&#34;</span>,
    <span style=color:#a6e22e>TimeKey</span>:        <span style=color:#e6db74>&#34;time&#34;</span>,
    <span style=color:#a6e22e>NameKey</span>:        <span style=color:#e6db74>&#34;zap&#34;</span>,
    <span style=color:#a6e22e>CallerKey</span>:      <span style=color:#e6db74>&#34;caller&#34;</span>,
    <span style=color:#a6e22e>StacktraceKey</span>:  <span style=color:#e6db74>&#34;stacktrace&#34;</span>,
    <span style=color:#a6e22e>LineEnding</span>:     <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>DefaultLineEnding</span>,
    <span style=color:#a6e22e>EncodeLevel</span>:    <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>LowercaseLevelEncoder</span>,
    <span style=color:#a6e22e>EncodeTime</span>:     <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>ISO8601TimeEncoder</span>,
    <span style=color:#a6e22e>EncodeDuration</span>: <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>StringDurationEncoder</span>,
    <span style=color:#a6e22e>EncodeCaller</span>:   <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>ShortCallerEncoder</span>,
    <span style=color:#a6e22e>EncodeName</span>:     <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>FullNameEncoder</span>,
}
<span style=color:#a6e22e>core</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>NewCore</span>(
	<span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>NewJSONEncoder</span>(<span style=color:#a6e22e>EncoderConfig</span>),
    <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>Lock</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>),
    <span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>InfoLevel</span>,
)
<span style=color:#a6e22e>logger</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>New</span>(
	<span style=color:#a6e22e>core</span>,
    <span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>AddCaller</span>(),
    <span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>AddStacktrace</span>(<span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>ErrorLevel</span>),
)
<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>sync</span>()
</code></pre></div><h3 id=option>Option</h3>
<p>可以用于对 Logger 时进行一些配置，Zap 提供的 Option 如下：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>AddCaller</span>() <span style=color:#a6e22e>Option</span>  <span style=color:#75715e>// 添加调用信息
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>AddCallerSkip</span>(<span style=color:#a6e22e>skip</span> <span style=color:#66d9ef>int</span>) <span style=color:#a6e22e>Option</span>  <span style=color:#75715e>// 报告调用信息时，跳过指定调用层数
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>WithCaller</span>(<span style=color:#a6e22e>enabled</span> <span style=color:#66d9ef>bool</span>) <span style=color:#a6e22e>Option</span>  <span style=color:#75715e>// 是否添加调用信息
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>AddStacktrace</span>(<span style=color:#a6e22e>lvl</span> <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>LevelEnabler</span>) <span style=color:#a6e22e>Option</span>  <span style=color:#75715e>// 异常时堆栈追踪
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Development</span>() <span style=color:#a6e22e>Option</span>  <span style=color:#75715e>// 开发模式
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ErrorOutput</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>WriteSyncer</span>) <span style=color:#a6e22e>Option</span>  <span style=color:#75715e>//异常输出位置
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Fields</span>(<span style=color:#a6e22e>fs</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>Field</span>) <span style=color:#a6e22e>Option</span>  <span style=color:#75715e>// 添加字段
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Hooks</span>(<span style=color:#a6e22e>hooks</span> <span style=color:#f92672>...</span><span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>Entry</span>) <span style=color:#66d9ef>error</span>) <span style=color:#a6e22e>Option</span>  <span style=color:#75715e>// 添加回调
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>IncreaseLevel</span>(<span style=color:#a6e22e>lvl</span> <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>LevelEnabler</span>) <span style=color:#a6e22e>Option</span>  <span style=color:#75715e>// 仅可以提高记录等级，不能降低
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>WrapCore</span>(<span style=color:#a6e22e>f</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>Core</span>) <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>Core</span>) <span style=color:#a6e22e>Option</span>  <span style=color:#75715e>// 用于包裹或替换 Core
</span></code></pre></div><h3 id=内置-logger>内置 Logger</h3>
<p>由于 <code>New</code> 方法创建 Logger 过于复杂，<code>zap</code> 包中提供了几个内建的 Logger。</p>
<ul>
<li>
<p><code>NewDevelopment</code></p>
<p>此 Logger 以人性化的格式记录 Debug 级别以上的日志和标准的异常信息。</p>
<p>Warn 和以上级别的日志会自动包含堆栈追踪。</p>
<p>此方法等价于 <code>NewDevelopmentConfig().Build(...Option)</code>。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewDevelopment</span>(<span style=color:#a6e22e>options</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>Option</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>, <span style=color:#66d9ef>error</span>)
</code></pre></div></li>
<li>
<p><code>NewProduction</code></p>
<p>此 Logger 以 Json 格式记录 Info 级别以上的日志和标准的异常信息。</p>
<p>Error 和以上级别的日志会自动包含堆栈追踪。</p>
<p>此方法等价于 <code>NewProductionConfig().Build(...Option)</code>。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewProduction</span>(<span style=color:#a6e22e>options</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>Option</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>, <span style=color:#66d9ef>error</span>)
</code></pre></div></li>
<li>
<p><code>NewExample</code></p>
<p>此 Logger 是一个常用于测试用例的 Logger。</p>
<p>它以 Json 格式记录 Debug 级别以上的日志和标准的异常信息。但是删去了时间戳和调用函数，以简短日志输出。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewExample</span>(<span style=color:#a6e22e>options</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>Option</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>
</code></pre></div></li>
</ul>
<h2 id=使用--config-创建-logger>使用 Config 创建 Logger</h2>
<p>除了使用 New 自定义创建外，使用 Config 来创建 Logger 会更加方便。</p>
<h3 id=config>Config</h3>
<p>Config 包含了绝大部分常见的设置。其中部分设置需要使用 <code>zapcore.EncoderConfig</code> 来进行配置。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Config</span> <span style=color:#66d9ef>struct</span> {
    <span style=color:#75715e>// 输出的日志级别，使用 Config.Level.SetLevel 可以原子性的更改输出的日志级别
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>Level</span> <span style=color:#a6e22e>AtomicLevel</span> <span style=color:#e6db74>`json:&#34;level&#34; yaml:&#34;level&#34;`</span>
    <span style=color:#75715e>// 是否开启开发模式，开启后会改变 DPanicLevel 的行为，栈追踪也会更自由
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>Development</span> <span style=color:#66d9ef>bool</span> <span style=color:#e6db74>`json:&#34;development&#34; yaml:&#34;development&#34;`</span>
    <span style=color:#75715e>// 是否关闭调用信息，默认状况下，所有的日志都会带有文件名和文件行数
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>DisableCaller</span> <span style=color:#66d9ef>bool</span> <span style=color:#e6db74>`json:&#34;disableCaller&#34; yaml:&#34;disableCaller&#34;`</span>
    <span style=color:#75715e>// 禁用自动堆栈追踪，默认情况下，堆栈追踪在开发模式抓取 WarnLevel 以上级别的日志，
</span><span style=color:#75715e></span>    <span style=color:#75715e>// 在生产模式抓取 ErrorLevel 以上级别的日志
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>DisableStacktrace</span> <span style=color:#66d9ef>bool</span> <span style=color:#e6db74>`json:&#34;disableStacktrace&#34; yaml:&#34;disableStacktrace&#34;`</span>
    <span style=color:#75715e>// 采样策略，作用是限制日志在每秒钟内的输出数量, 以防止CPU和IO被过度占用。
</span><span style=color:#75715e></span>    <span style=color:#75715e>// 如果为 nil 则禁用采样
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>Sampling</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>SamplingConfig</span> <span style=color:#e6db74>`json:&#34;sampling&#34; yaml:&#34;sampling&#34;`</span>
    <span style=color:#75715e>// Encoding 设置日志的编码格式，可选的有 json 和 console，也可以使用 RegisterEncoder
</span><span style=color:#75715e></span>    <span style=color:#75715e>// 来注册第三方编码方式
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>Encoding</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;encoding&#34; yaml:&#34;encoding&#34;`</span>
    <span style=color:#75715e>// 注册的 Encoder 的设置，详见 zapcore.EncoderConfig 
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>EncoderConfig</span> <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>EncoderConfig</span> <span style=color:#e6db74>`json:&#34;encoderConfig&#34; yaml:&#34;encoderConfig&#34;`</span>
    <span style=color:#75715e>// 日志输出的位置，如果是控制台，则是 stdout，或者是日志文件路径
</span><span style=color:#75715e></span>    <span style=color:#75715e>// 详见 Open
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>OutputPaths</span> []<span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;outputPaths&#34; yaml:&#34;outputPaths&#34;`</span>
    <span style=color:#a6e22e>ErrorOutputPaths</span> []<span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;errorOutputPaths&#34; yaml:&#34;errorOutputPaths&#34;`</span>
    <span style=color:#75715e>// 添加到根 logger 的字段
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>InitialFields</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{} <span style=color:#e6db74>`json:&#34;initialFields&#34; yaml:&#34;initialFields&#34;`</span>
}
</code></pre></div><p>在创建 Config 之后，使用 <code>Build()</code> 方法，即可根据 Config 创建相应的 Logger。</p>
<p>例子：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>cfg</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>Config</span>{
    <span style=color:#a6e22e>Level</span>:             <span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>NewAtomicLevelAt</span>(<span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>DebugLevel</span>),
    <span style=color:#a6e22e>Development</span>:       <span style=color:#66d9ef>false</span>,
    <span style=color:#a6e22e>DisableCaller</span>:     <span style=color:#66d9ef>false</span>,
    <span style=color:#a6e22e>DisableStacktrace</span>: <span style=color:#66d9ef>false</span>,
    <span style=color:#a6e22e>Sampling</span>:          <span style=color:#66d9ef>nil</span>,
    <span style=color:#a6e22e>Encoding</span>:          <span style=color:#e6db74>&#34;json&#34;</span>,
    <span style=color:#a6e22e>EncoderConfig</span>: <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>EncoderConfig</span>{
        <span style=color:#a6e22e>MessageKey</span>:     <span style=color:#e6db74>&#34;msg&#34;</span>,
        <span style=color:#a6e22e>LevelKey</span>:       <span style=color:#e6db74>&#34;level&#34;</span>,
        <span style=color:#a6e22e>TimeKey</span>:        <span style=color:#e6db74>&#34;time&#34;</span>,
        <span style=color:#a6e22e>NameKey</span>:        <span style=color:#e6db74>&#34;zap&#34;</span>,
        <span style=color:#a6e22e>CallerKey</span>:      <span style=color:#e6db74>&#34;caller&#34;</span>,
        <span style=color:#a6e22e>StacktraceKey</span>:  <span style=color:#e6db74>&#34;stacktrace&#34;</span>,
        <span style=color:#a6e22e>LineEnding</span>:     <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>DefaultLineEnding</span>,
        <span style=color:#a6e22e>EncodeLevel</span>:    <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>LowercaseLevelEncoder</span>,
        <span style=color:#a6e22e>EncodeTime</span>:     <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>ISO8601TimeEncoder</span>,
        <span style=color:#a6e22e>EncodeDuration</span>: <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>StringDurationEncoder</span>,
        <span style=color:#a6e22e>EncodeCaller</span>:   <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>ShortCallerEncoder</span>,
        <span style=color:#a6e22e>EncodeName</span>:     <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>FullNameEncoder</span>,
    },
    <span style=color:#a6e22e>OutputPaths</span>:      []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;stdout&#34;</span>},
    <span style=color:#a6e22e>ErrorOutputPaths</span>: []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;stderr&#34;</span>},
    <span style=color:#a6e22e>InitialFields</span>:    <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}{<span style=color:#e6db74>&#34;app&#34;</span>: <span style=color:#e6db74>&#34;zapdex&#34;</span>},
}

<span style=color:#a6e22e>logger</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cfg</span>.<span style=color:#a6e22e>Build</span>()
<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
	panic(<span style=color:#a6e22e>err</span>)
}
<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Sync</span>()

<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;logger construction succeeded&#34;</span>)
</code></pre></div><h3 id=atomiclevel>AtomicLevel</h3>
<p>这是 <code>Zap</code> 中用来表示日志级别的对象，可以原子性的修改。</p>
<p>创建 AtomicLevel：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewAtomicLevel</span>() <span style=color:#a6e22e>AtomicLevel</span>
<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewAtomicLevelAt</span>(<span style=color:#a6e22e>l</span> <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>Level</span>) <span style=color:#a6e22e>AtomicLevel</span>
</code></pre></div><p>更改 AtomicLevel：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>lvl</span> <span style=color:#a6e22e>AtomicLevel</span>) <span style=color:#a6e22e>SetLevel</span>(<span style=color:#a6e22e>l</span> <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>Level</span>)
</code></pre></div><p>创建或更改特定的日志级别需要 <code>zapcore.Level</code>，以下是其定义：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>const</span> (
    <span style=color:#a6e22e>DebugLevel</span> <span style=color:#a6e22e>Level</span> = <span style=color:#66d9ef>iota</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>  <span style=color:#75715e>// production 环境会被禁用
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>InfoLevel</span>                    <span style=color:#75715e>// 最常见的级别
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>WarnLevel</span>                    
    <span style=color:#a6e22e>ErrorLevel</span>
    <span style=color:#a6e22e>DPanicLevel</span>                  <span style=color:#75715e>// DpanicLevel 在 development 环境中会记录日志并 panic
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>PanicLevel</span>                   <span style=color:#75715e>// PanicLevel 会记录日志并 panic
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>FatalLevel</span>                   <span style=color:#75715e>// PanicLevel 会记录日志并调用 os.Exit(1)
</span><span style=color:#75715e></span>)
</code></pre></div><h2 id=logger>Logger</h2>
<h3 id=输出日志>输出日志</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>log</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>) <span style=color:#a6e22e>Debug</span>(<span style=color:#a6e22e>msg</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>fields</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>Field</span>)
<span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>log</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>) <span style=color:#a6e22e>Info</span>(<span style=color:#a6e22e>msg</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>fields</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>Field</span>)
<span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>log</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>) <span style=color:#a6e22e>Warn</span>(<span style=color:#a6e22e>msg</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>fields</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>Field</span>)
<span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>log</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>) <span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>msg</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>fields</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>Field</span>)
<span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>log</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>) <span style=color:#a6e22e>DPanic</span>(<span style=color:#a6e22e>msg</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>fields</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>Field</span>)
<span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>log</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>) <span style=color:#a6e22e>Panic</span>(<span style=color:#a6e22e>msg</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>fields</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>Field</span>)
<span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>log</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>) <span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>msg</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>fields</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>Field</span>)
</code></pre></div><h3 id=全局-logger>全局 Logger</h3>
<p>使用 <code>ReplaceGlobals</code> 方法可以将 logger 设置为全局的 logger：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ReplaceGlobals</span>(<span style=color:#a6e22e>logger</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>) <span style=color:#66d9ef>func</span>()
</code></pre></div><p>设置为全局 logger 后，使用 <code>L</code> 方法就可以在任何位置获取这个全局的 logger：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>L</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>
</code></pre></div><h3 id=sugaredlogger>SugaredLogger</h3>
<p>logger 在输出日志时，字段需要指定类型，较为麻烦，使用 <code>SugaredLogger</code> 则可以在输出日志时较为方便，但性能较低。获取 <code>SugaredLogger</code>：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>log</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>) <span style=color:#a6e22e>Sugar</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>SugaredLogger</span>
</code></pre></div><h2 id=zapcore>ZapCore</h2>
<p><code>ZapCore</code> 是 Zap 中的核心部分，在需要细致且底层的配置时使用。</p>
<p>导入：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;go.uber.org/zap/zapcore&#34;</span>
</code></pre></div><h3 id=core>Core</h3>
<p>创建 Core 主要使用 <code>NewCore</code> 方法：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewCore</span>(<span style=color:#a6e22e>enc</span> <span style=color:#a6e22e>Encoder</span>, <span style=color:#a6e22e>ws</span> <span style=color:#a6e22e>WriteSyncer</span>, <span style=color:#a6e22e>enab</span> <span style=color:#a6e22e>LevelEnabler</span>) <span style=color:#a6e22e>Core</span>
</code></pre></div><p>参数：</p>
<ul>
<li>
<p><code>enc Encoder</code> - 使用 <code>EncoderConfig</code> 创建的 Encoder，Zap 提供了最常见的两种：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewConsoleEncoder</span>(<span style=color:#a6e22e>cfg</span> <span style=color:#a6e22e>EncoderConfig</span>) <span style=color:#a6e22e>Encoder</span>
<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewJSONEncoder</span>(<span style=color:#a6e22e>cfg</span> <span style=color:#a6e22e>EncoderConfig</span>) <span style=color:#a6e22e>Encoder</span>
</code></pre></div></li>
<li>
<p><code>ws WriteSyncer</code> - 表示日志写入位置的接口，可以使用 <code>AddSync</code> 创建：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>AddSync</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>Writer</span>) <span style=color:#a6e22e>WriteSyncer</span>
</code></pre></div><p>注：<code>*os.File</code>、<code>os.Stderr</code>、<code>os.Stdout</code> 已经实现了此接口。</p>
<p>在并发情况下，需要给 WriteSyncer 加锁，可以使用 <code>Lock</code> 方法：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Lock</span>(<span style=color:#a6e22e>ws</span> <span style=color:#a6e22e>WriteSyncer</span>) <span style=color:#a6e22e>WriteSyncer</span>
</code></pre></div></li>
<li>
<p><code>enab LevelEnabler</code> - 用于决定记录什么级别的日志，[AtomicLevel](#2. AtomicLevel) 已实现这一接口。</p>
</li>
</ul>
<h4 id=创建多个-core>创建多个 Core</h4>
<p>有些时候我们需要同时将日志输出到多个位置，这样的情况下则需要我们创建多个 <code>Core</code>，并合并成一个：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewTee</span>(<span style=color:#a6e22e>cores</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>Core</span>) <span style=color:#a6e22e>Core</span>
</code></pre></div><h3 id=encoderconfig>EncoderConfig</h3>
<p><code>zapcore.EncoderConfig</code> 用于配置 <code>zap.Config</code> 中的 Encoder。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>EncoderConfig</span> <span style=color:#66d9ef>struct</span> {
    <span style=color:#75715e>// 用于设置默认字段的字段名，如果值为空，则记录日志时忽略此字段
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>MessageKey</span>    <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;messageKey&#34; yaml:&#34;messageKey&#34;`</span>
    <span style=color:#a6e22e>LevelKey</span>      <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;levelKey&#34; yaml:&#34;levelKey&#34;`</span>
    <span style=color:#a6e22e>TimeKey</span>       <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;timeKey&#34; yaml:&#34;timeKey&#34;`</span>
    <span style=color:#a6e22e>NameKey</span>       <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;nameKey&#34; yaml:&#34;nameKey&#34;`</span>
    <span style=color:#a6e22e>CallerKey</span>     <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;callerKey&#34; yaml:&#34;callerKey&#34;`</span>
    <span style=color:#a6e22e>StacktraceKey</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;stacktraceKey&#34; yaml:&#34;stacktraceKey&#34;`</span>
    <span style=color:#75715e>// 每行日志的分隔符
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>LineEnding</span>    <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;lineEnding&#34; yaml:&#34;lineEnding&#34;`</span>
	<span style=color:#75715e>// 日志级别的编码
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>EncodeLevel</span>    <span style=color:#a6e22e>LevelEncoder</span>    <span style=color:#e6db74>`json:&#34;levelEncoder&#34; yaml:&#34;levelEncoder&#34;`</span>
    <span style=color:#75715e>// 时间格式的编码
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>EncodeTime</span>     <span style=color:#a6e22e>TimeEncoder</span>     <span style=color:#e6db74>`json:&#34;timeEncoder&#34; yaml:&#34;timeEncoder&#34;`</span>
    <span style=color:#a6e22e>EncodeDuration</span> <span style=color:#a6e22e>DurationEncoder</span> <span style=color:#e6db74>`json:&#34;durationEncoder&#34; yaml:&#34;durationEncoder&#34;`</span>
    <span style=color:#75715e>// 调用信息的编码
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>EncodeCaller</span>   <span style=color:#a6e22e>CallerEncoder</span>   <span style=color:#e6db74>`json:&#34;callerEncoder&#34; yaml:&#34;callerEncoder&#34;`</span>
    <span style=color:#75715e>// 与上面几种编码器不同，此编码器是可选的，默认会使用 FullNameEncoder
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>EncodeName</span> <span style=color:#a6e22e>NameEncoder</span> <span style=color:#e6db74>`json:&#34;nameEncoder&#34; yaml:&#34;nameEncoder&#34;`</span>
}
</code></pre></div><h4 id=内置-encoder>内置 Encoder</h4>
<p>Zap 中提供了几个编码器类型，可以用于自定义编码。分别是：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>LevelEncoder</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>Level</span>, <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)
<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CallerEncoder</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>EntryCaller</span>, <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)
<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>DurationEncoder</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>, <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)
<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>NameEncoder</span> <span style=color:#66d9ef>func</span>(<span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)
<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>TimeEncoder</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>, <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)
</code></pre></div><p>Zap 也提供了一部分常用的编码器实现，可以根据需要使用：</p>
<ul>
<li>
<p>LevelEncoder</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>CapitalColorLevelEncoder</span>(<span style=color:#a6e22e>l</span> <span style=color:#a6e22e>Level</span>, <span style=color:#a6e22e>enc</span> <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)  <span style=color:#75715e>// 大写彩色
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>CapitalLevelEncoder</span>(<span style=color:#a6e22e>l</span> <span style=color:#a6e22e>Level</span>, <span style=color:#a6e22e>enc</span> <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)  <span style=color:#75715e>// 大写
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>LowercaseColorLevelEncoder</span>(<span style=color:#a6e22e>l</span> <span style=color:#a6e22e>Level</span>, <span style=color:#a6e22e>enc</span> <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)  <span style=color:#75715e>// 小写彩色
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>LowercaseLevelEncoder</span>(<span style=color:#a6e22e>l</span> <span style=color:#a6e22e>Level</span>, <span style=color:#a6e22e>enc</span> <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)  <span style=color:#75715e>// 小写
</span></code></pre></div></li>
<li>
<p>TimeEncoder</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>EpochTimeEncoder</span>(<span style=color:#a6e22e>t</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>, <span style=color:#a6e22e>enc</span> <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)  <span style=color:#75715e>// 时间戳
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>EpochMillisTimeEncoder</span>(<span style=color:#a6e22e>t</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>, <span style=color:#a6e22e>enc</span> <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)  <span style=color:#75715e>// 毫秒级时间戳
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>EpochNanosTimeEncoder</span>(<span style=color:#a6e22e>t</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>, <span style=color:#a6e22e>enc</span> <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)  <span style=color:#75715e>// 纳秒级时间戳
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>RFC3339TimeEncoder</span>(<span style=color:#a6e22e>t</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>, <span style=color:#a6e22e>enc</span> <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)  <span style=color:#75715e>// 秒级标准格式
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ISO8601TimeEncoder</span>(<span style=color:#a6e22e>t</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>, <span style=color:#a6e22e>enc</span> <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)  <span style=color:#75715e>// 毫秒级标准格式
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>RFC3339NanoTimeEncoder</span>(<span style=color:#a6e22e>t</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>, <span style=color:#a6e22e>enc</span> <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)  <span style=color:#75715e>// 纳秒级标准格式
</span></code></pre></div></li>
<li>
<p>CallerEncoder</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>FullCallerEncoder</span>(<span style=color:#a6e22e>caller</span> <span style=color:#a6e22e>EntryCaller</span>, <span style=color:#a6e22e>enc</span> <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)  <span style=color:#75715e>// 长路径
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ShortCallerEncoder</span>(<span style=color:#a6e22e>caller</span> <span style=color:#a6e22e>EntryCaller</span>, <span style=color:#a6e22e>enc</span> <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)  <span style=color:#75715e>// 短路径
</span></code></pre></div></li>
<li>
<p>NameEncoder</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>FullNameEncoder</span>(<span style=color:#a6e22e>loggerName</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>enc</span> <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)
</code></pre></div></li>
<li>
<p>DurationEncoder</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>MillisDurationEncoder</span>(<span style=color:#a6e22e>d</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>, <span style=color:#a6e22e>enc</span> <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)
<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NanosDurationEncoder</span>(<span style=color:#a6e22e>d</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>, <span style=color:#a6e22e>enc</span> <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)
<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>SecondsDurationEncoder</span>(<span style=color:#a6e22e>d</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>, <span style=color:#a6e22e>enc</span> <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)
<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>StringDurationEncoder</span>(<span style=color:#a6e22e>d</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>, <span style=color:#a6e22e>enc</span> <span style=color:#a6e22e>PrimitiveArrayEncoder</span>)
</code></pre></div></li>
</ul>
<h2 id=日志文件切割归档>日志文件切割归档</h2>
<p>使用第三方库 <code>Lumberjack</code> 实现。安装：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ go get -u github.com/natefinch/lumberjack
</code></pre></div><h3 id=接入-zap>接入 Zap</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>logWriter</span>() <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>WriteSyncer</span> {
	<span style=color:#a6e22e>lumberJackLogger</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>lumberjack</span>.<span style=color:#a6e22e>Logger</span>{
		<span style=color:#a6e22e>Filename</span>:   <span style=color:#e6db74>&#34;./test.log&#34;</span>,
		<span style=color:#a6e22e>MaxSize</span>:    <span style=color:#ae81ff>10</span>,
		<span style=color:#a6e22e>MaxBackups</span>: <span style=color:#ae81ff>5</span>,
		<span style=color:#a6e22e>MaxAge</span>:     <span style=color:#ae81ff>30</span>,
		<span style=color:#a6e22e>Compress</span>:   <span style=color:#66d9ef>false</span>,
	}
	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>AddSync</span>(<span style=color:#a6e22e>lumberJackLogger</span>)
}
</code></pre></div><p>Lumberjack 参数：</p>
<ul>
<li>Filename: 日志文件的位置</li>
<li>MaxSize：在进行切割之前，日志文件的最大大小（以MB为单位）</li>
<li>MaxBackups：保留旧文件的最大个数</li>
<li>MaxAges：保留旧文件的最大天数</li>
<li>Compress：是否压缩/归档旧文件</li>
</ul>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/tags/go/>Go</a>
</section>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under MIT License</span>
</section>
<section class=article-lastmod><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>
最后更新于 2021-11-09 23:34:24
</span>
</section></footer>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css integrity=sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js integrity=sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title>相关文章</h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article>
<a href=/post/go-gorm-crud/>
<div class=article-details>
<h2 class=article-title>Go Gorm CRUD</h2>
</div>
</a>
</article>
<article>
<a href=/post/go-gorm-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E4%B8%8E%E6%A8%A1%E5%9E%8B/>
<div class=article-details>
<h2 class=article-title>Go Gorm 数据库连接与模型</h2>
</div>
</a>
</article>
<article>
<a href=/post/go-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-gjson/>
<div class=article-details>
<h2 class=article-title>Go 第三方库 gjson</h2>
</div>
</a>
</article>
<article>
<a href=/post/go-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-grpc/>
<div class=article-details>
<h2 class=article-title>Go 第三方库 grpc</h2>
</div>
</a>
</article>
<article>
<a href=/post/go-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-viper/>
<div class=article-details>
<h2 class=article-title>Go 第三方库 viper</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<footer class=site-footer>
<section class=copyright>
&copy;
2021 WNANBEI
</section>
<section class=powerby>
The world has kissed my soul with its pain, asking for its return in songs. <br>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.5.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title">目录</h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ol>
<li><a href=#创建-logger>创建 Logger</a>
<ol>
<li><a href=#new>New</a></li>
<li><a href=#option>Option</a></li>
<li><a href=#内置-logger>内置 Logger</a></li>
</ol>
</li>
<li><a href=#使用--config-创建-logger>使用 Config 创建 Logger</a>
<ol>
<li><a href=#config>Config</a></li>
<li><a href=#atomiclevel>AtomicLevel</a></li>
</ol>
</li>
<li><a href=#logger>Logger</a>
<ol>
<li><a href=#输出日志>输出日志</a></li>
<li><a href=#全局-logger>全局 Logger</a></li>
<li><a href=#sugaredlogger>SugaredLogger</a></li>
</ol>
</li>
<li><a href=#zapcore>ZapCore</a>
<ol>
<li><a href=#core>Core</a>
<ol>
<li><a href=#创建多个-core>创建多个 Core</a></li>
</ol>
</li>
<li><a href=#encoderconfig>EncoderConfig</a>
<ol>
<li><a href=#内置-encoder>内置 Encoder</a></li>
</ol>
</li>
</ol>
</li>
<li><a href=#日志文件切割归档>日志文件切割归档</a>
<ol>
<li><a href=#接入-zap>接入 Zap</a></li>
</ol>
</li>
</ol>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>